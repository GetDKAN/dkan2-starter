{"ast":null,"code":"/*\n  Module Dependencies\n*/\nvar htmlparser = require('htmlparser2');\n/*\n  Parser\n*/\n\n\nexports = module.exports = function (content, options) {\n  var dom = exports.evaluate(content, options),\n      // Generic root element\n  root = exports.evaluate('<root></root>', options)[0];\n  root.type = 'root'; // Update the dom using the root\n\n  exports.update(dom, root);\n  return root;\n};\n\nexports.evaluate = function (content, options) {\n  // options = options || $.fn.options;\n  var dom;\n\n  if (typeof content === 'string' || Buffer.isBuffer(content)) {\n    dom = htmlparser.parseDOM(content, options);\n  } else {\n    dom = content;\n  }\n\n  return dom;\n};\n/*\n  Update the dom structure, for one changed layer\n*/\n\n\nexports.update = function (arr, parent) {\n  // normalize\n  if (!Array.isArray(arr)) arr = [arr]; // Update parent\n\n  if (parent) {\n    parent.children = arr;\n  } else {\n    parent = null;\n  } // Update neighbors\n\n\n  for (var i = 0; i < arr.length; i++) {\n    var node = arr[i]; // Cleanly remove existing nodes from their previous structures.\n\n    var oldParent = node.parent || node.root,\n        oldSiblings = oldParent && oldParent.children;\n\n    if (oldSiblings && oldSiblings !== arr) {\n      oldSiblings.splice(oldSiblings.indexOf(node), 1);\n\n      if (node.prev) {\n        node.prev.next = node.next;\n      }\n\n      if (node.next) {\n        node.next.prev = node.prev;\n      }\n    }\n\n    if (parent) {\n      node.prev = arr[i - 1] || null;\n      node.next = arr[i + 1] || null;\n    } else {\n      node.prev = node.next = null;\n    }\n\n    if (parent && parent.type === 'root') {\n      node.root = parent;\n      node.parent = null;\n    } else {\n      node.root = null;\n      node.parent = parent;\n    }\n  }\n\n  return parent;\n}; // module.exports = $.extend(exports);","map":null,"metadata":{},"sourceType":"script"}